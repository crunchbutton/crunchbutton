<script src="/assets/js/json2.js"></script>
<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/jquery-ui.min.js"></script>
<script src="/assets/js/jquery.history.js"></script>
<script src="/assets/js/jquery.cookie.js"></script>

<script type="text/javascript">
$(function() {
	<? if (!c::isBot()) : ?>
		$('.home-text').hide();
	<? endif ; ?>
	App.communities = {};
	<? foreach (Community::all(c::getPagePiece(0)) as $community) : ?>
		App.communities['<?=$community->permalink?>'] = {
			<? foreach ($community->properties() as $key => $val) : ?>
				'<?=$key?>': "<?=$val?>",
			<? endforeach ; ?>
			stored: true
		};
	<? endforeach ; ?>
	<? if ($this->community) : ?>
		App.cached['Community'][<?=$this->community->id_community?>] = new Community(<?=str_replace("'","\\'",json_encode($this->community->exports()))?>);
		App.cached['Community']['<?=$this->community->permalink?>'] = App.cached['Community'][<?=$this->community->id_community?>];
		<? if (!c::getPagePiece(1)) : ?>
			App.loadedPage = '<?=$this->community->permalink?>';
		<? endif ; ?>
	<? endif ; ?>
	
	App.topCommunities = [];	
	<? foreach (Restaurant::o(1, 60) as $restaurant) : ?>
		App.topCommunities[App.topCommunities.length] = {
			id_community: '<?=$restaurant->community()->permalink?>',
			name: '<?=$restaurant->community()->name?>',
			image: '/cache/images/<?=$restaurant->thumb()->getFileName()?>',
			restaurant: '<?=$restaurant->name?>'
		};
	<? endforeach ; ?>

});
</script>

<?
	if (!$scripts) {
		$scripts = ['app'];
	}
?>
<? foreach ($scripts as $script) : ?>
	<script src="/assets/js/<?=$script?>.js?v=<?=Cana_Util::gitVersion()?>"></script>
<? endforeach ; ?>

<script src="/assets/js/base.js?v=<?=Cana_Util::gitVersion()?>"></script>
<script src="/assets/js/orm.js?v=<?=Cana_Util::gitVersion()?>"></script>
<script src="/assets/js/community.js?v=<?=Cana_Util::gitVersion()?>"></script>
<script src="/assets/js/restaurant.js?v=<?=Cana_Util::gitVersion()?>"></script>
<script src="/assets/js/dish.js?v=<?=Cana_Util::gitVersion()?>"></script>
<script src="/assets/js/option.js?v=<?=Cana_Util::gitVersion()?>"></script>
<script src="/assets/js/category.js?v=<?=Cana_Util::gitVersion()?>"></script>
<script src="/assets/js/order.js?v=<?=Cana_Util::gitVersion()?>"></script>

<script type="text/javascript">
    (function(c,a){window.mixpanel=a;var b,d,h,e;b=c.createElement("script");
    b.type="text/javascript";b.async=!0;b.src=("https:"===c.location.protocol?"https:":"http:")+
    '//cdn.mxpnl.com/libs/mixpanel-2.1.min.js';d=c.getElementsByTagName("script")[0];
    d.parentNode.insertBefore(b,d);a._i=[];a.init=function(b,c,f){function d(a,b){
    var c=b.split(".");2==c.length&&(a=a[c[0]],b=c[1]);a[b]=function(){a.push([b].concat(
    Array.prototype.slice.call(arguments,0)))}}var g=a;"undefined"!==typeof f?g=a[f]=[]:
    f="mixpanel";g.people=g.people||[];h=['disable','track','track_pageview','track_links',
    'track_forms','register','register_once','unregister','identify','name_tag',
    'set_config','people.identify','people.set','people.increment'];for(e=0;e<h.length;e++)d(g,h[e]);
    a._i.push([b,c,f])};a.__SV=1.1;})(document,window.mixpanel||[]);
    mixpanel.init('6eb260b54eecfd293d50b5f1423c6e98');
</script>

<script type="application/x-javascript">
	addEventListener('touchstart',function(){}); addEventListener('load', function(event) {setTimeout(scrollTo, 80, 0, 1);}, false);
</script>