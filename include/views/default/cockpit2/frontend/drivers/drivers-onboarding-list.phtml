<div class="top-pad"></div>

<div class="content-padding">

	<div class="box-content2 box-content-table box-search-bar table-sticky-dependant">
		<table>
			<tr>
				<td colspan="6">
					<div title="More options" class="search-bar-options" ng-class="{'orange':show_more_options}" ng-click="moreOptions()">
						<i class="fa" ng-class="{'fa-search':show_more_options, 'fa-search-plus':!show_more_options}"></i>
					</div>&nbsp;&nbsp;<input type="text" ng-model="query.search" id="search" tabindex="1" placeholder="Search drivers">
				</td>
				<td colspan="3" class="search-title-nav">
					<div class="page-title-nav">
						<a href="/drivers/onboarding/docs"><button class="button button-green nav-button-grey"><i class="fa fa-briefcase"></i><span>Documents</span></button></a>
						<a href="/drivers/onboarding/new"><button class="button button-green nav-button-green"><i class="fa fa-plus"></i><span>Add Driver</span></button></a>
						<a href="/staff/notes"><button class="button button-green nav-button-green"><i class="fa fa-file"></i><span>Notes</span></button></a>
					</div>
				</td>
			</tr>
			<tr ng-if="show_more_options">
				<th>Community</th>
				<td>
					<ui-select ng-model="query.community" theme="select2" close-on-select="true" style="width: 300px;" title="Select a community">
						<ui-select-match placeholder="Select a community">{{$select.selected.name}}</ui-select-match>
						<ui-select-choices repeat="community.id_community as community in communities | propsFilter: {name: $select.search}">
							{{community.name}}
						</ui-select-choices>
					</ui-select>
					<a ng-show="query.community" ng-click="query.community=null" href=""><button class="button button-small button-empty button-green"><i class="fa fa-trash-o"></i></button></a>
				</td>
				<th>Able To Receive Text Message</th>
				<td>
					<select ng-model="query.send_text" ng-options="option.value as option.label for option in send_text_options"></select>
				</td>
				<th>Status</th>
				<td>
					<select ng-model="query.status" ng-options="option.value as option.label for option in statuses"></select>
				</td>
				<th>Drivers displayed</th>
				<td>
					<select ng-model="query.limit" ng-options="limit.value as limit.label for limit in limits"></select>
				</td>
				<td></td>
			</td>
		</table>
	</div>
	<div class="bar-loader bar-loader-search" ng-class="{'bar-loader-loading': loading}"></div>


	<div class="box-content2 box-content-table">
		<table class="tb-zebra" sticky-header>
			<thead>
				<tr>
					<th>Name</th>
					<th>Schedule</th>
					<th>Note</th>
					<th nowrap="nowrap" class="tb-center">
						Send Text<br>Message
						<span class="link orange no-underline" title="Send sms about schedule?">*</span>
					</th>
					<th class="tb-small tb-center">Payment</th>
					<th class="tb-small tb-center">Docs</th>
					<th class="tb-small"> </th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="driver in drivers" ng-init="$last ? ngRepeatFinished() : null" ng-attr-tabindex="{{$index+1}}" tab-select="/drivers/onboarding/{{driver.id_admin}}">
					<td nowrap="">
						<span class="listview-bold">{{driver.name}}</span>
						<br><span class="listview-smaller">{{driver.login}}</span>
						<br><a href ng-click="callText(s.phone)" class="listview-smaller">{{driver.phone | formatPhone}}</a>
						<div>
								<span class="tag tag-green" ng-if="driver.active">Active</span>
								<span class="tag tag-red" ng-if="!driver.active">Inactive</span>

								<span class="tag tag-orange" ng-if="driver.vehicle == 'car'">Car</span>
								<span class="tag tag-purple" ng-if="driver.vehicle == 'bike'">Bike</span>
								<span class="tag tag-darkgreen" ng-if="driver.vehicle == 'rollerblades'">Rollerblades</span>
								<span class="tag tag-lightblue" ng-if="driver.vehicle == 'rickshaw'">Rickshaw</span>
								<span class="tag tag-yellow" ng-if="driver.vehicle == 'skateboard'">Skateboard</span>
								<span class="tag tag-grey" ng-if="!driver.vehicle">None</span>

								<span class="tag tag-blue" ng-if="driver.payment_type == 'orders'">
									Commission
									<span ng-if="driver.amount_per_order">${{driver.amount_per_order | formatPrice}}/order</span>
								</span>
								<span class="tag tag-purple" ng-if="driver.payment_type == 'hours'">
									Hourly with tips
									<span ng-if="driver.hour_rate">${{driver.hour_rate | formatPrice}}</span>
								</span>
								<span class="tag tag-orange" ng-if="driver.payment_type == 'hours_without_tips'">
									Hourly without tips
									<span ng-if="driver.hour_rate">${{driver.hour_rate | formatPrice}}</span>
								</span>
								<span class="tag tag-yellow" ng-if="driver.payment_type == 'making_whole'">
									Making whole
									<span ng-if="driver.hour_rate">${{driver.hour_rate | formatPrice}} / hour</span>
									<span ng-if="driver.hour_rate && driver.amount_per_order"> | </span>
									<span ng-if="driver.amount_per_order">${{driver.amount_per_order | formatPrice}}/order</span>
								</span>
								<span class="tag tag-grey" ng-if="!driver.payment_type">Payment Type Missing</span>

						</div>
						<div>
							<span class="listview-smaller" ng-repeat="community in driver.communities">
								{{community}}
							</span>
						</div>
					</td>
					<td nowrap="nowrap">
						<span class="tag tag-green" ng-if="driver.shift_status.completed == 1">Complete</span>
						<span class="tag tag-red" ng-if="!driver.shift_status.completed == 1">Incomplete</span><br>
						<span class="listview-smaller">
							Want: <strong>{{driver.shift_status.shifts}}</strong><br>
							Assigned: <strong>{{driver.total_shifts}}</strong>
						</span>
					</td>
					<td>
						<div class="listview-smaller" ng-if="driver.note.text">
							{{driver.note.text}}
							<br>
							<span class="italic">
								by {{driver.note.added_by}}
								<span class="no-wrap">{{driver.note.date_utc | localtime | timestamp | date:'MM/dd @ HH:mm'}}</span>
								<button class="button button-small button-empty button-green" ng-click="last_note(driver.id_admin);"><i class="fa fa-pencil"></i></button>
							</span>
						</div>
						<div ng-if="!driver.note.text" class="listview-smaller">
							<span class="italic">Add note</span>
							<button class="button button-small button-empty button-green" ng-click="last_note(driver.id_admin);"><i class="fa fa-pencil"></i></button>
						</div>
					</td>
					<td class="tb-center tb-v-center">
						<span class="listview-smaller">
							<label class="switch-wrap">
								<input type="checkbox" class="switch" ng-change="send_text_about_schedule( driver.id_admin, driver.send_text_about_schedule );" ng-model="driver.send_text_about_schedule"/><div></div>
							</label>
						</span>
					</td>
					<td class="tb-center tb-v-center">
						<span class="tag tag-green" ng-if="driver.status.payment">OK</span>
						<span class="tag tag-red" ng-if="!driver.status.payment">Missing</span>
					</td>
					<td class="tb-center tb-v-center">
						<span class="tag tag-green" ng-if="driver.sent_all_docs">OK</span>
						<span class="tag tag-red" ng-if="!driver.sent_all_docs">Missing</span>
					</td>
					<td nowrap class="tb-v-center">
						<a href="/staff/{{driver.login}}"><button class="button button-small button-empty button-green"><i class="fa fa-car"></i>&nbsp;&nbsp;View</button></a>
					</td>
				</tr>
			</tbody>
		</table>
	</div>

	<table class="tb-pagination right" ng-if="pages > 1" page-key>
		<tbody>
			<tr>
				<td class="td-prev"><button class="button orange" ng-if="query.page > 1" ng-click="setPage(query.page-1)">prev</button></td>
				<td class="td-info">Page {{query.page}} of {{pages}}</td>
				<td class="td-next"><button class="button orange" ng-if="query.page < pages" ng-click="setPage(query.page+1)">next</button></td>
			</tr>
		</tbody>
	</table>

	<div class="divider"></div>

</div>
