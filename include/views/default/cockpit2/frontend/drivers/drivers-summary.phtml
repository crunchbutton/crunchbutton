<div class="top-pad"></div>

<div class="content-padding" ng-show="ready">

	<h1 class="title left"><i class="fa fa-calendar"></i><span>Summary</span></h1>

	<div class="divider"></div>

	<form name="form" ng-show="drivers">

		<ul class="ul-inputs box-content">
			<li class="li-input">
				<div class="label">Select a driver:</div>
				<div class="input">
					<select name="driverSummary" ng-model="id_admin" ng-change="load_driver()" ng-options="opt.id_admin as opt.name for opt in drivers"></select>
				</div>
			</li>
		</ul>

	</form>

	<div ng-show="isLoading">
		<span><i class="fa fa-circle-o-notch fa-spin"></i> Loading</span>
	</div>

	<div ng-if="summary.payments">

		<h2 class="title">Summary</h2>

		<table class="tb-grid tb-zebra">
			<thead>
				<tr>
					<td>Type</td>
					<td>Amount</td>
					<td>Status</td>
					<td>Approximate payment date</td>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="payment in summary.payments">
					<td><span class="link" ng-click="show_payment( payment.id_payment_schedule );">{{payment.type}}</span></td>
					<td positive-or-negative-color="{{payment.amount}}">
						${{payment.amount | formatPrice}}
					</td>
					<td>
						<span ng-class="{ 'span-driver-summary-paid': payment.status == 'Paid',
															'span-driver-summary-pending': payment.status == 'Pending',
															'span-driver-summary-processing': payment.status == 'Processing' }">
													{{payment.status}}
						</span>
					</td>
					<td>{{payment.paid_date}}</td>
				</tr>
			</tbody>
		</table>

		<p><span ng-click="payments()" class="link orange">All payments</span></p>

		<div ng-if="summary.earnings">

			<br><br>

			<table class="tb-grid tb-zebra">
				<tbody>
					<tr ng-if="summary.earnings.current">
						<td>Earned so far this week</td>
						<td positive-or-negative-color="{{summary.earnings.current.total_payment}}">
							${{summary.earnings.current.total_payment | formatPrice}}
						</td>
					</tr>
					<tr ng-if="summary.earnings.current">
						<td>Rembursement so far this week</td>
						<td positive-or-negative-color="{{summary.earnings.current.total_reimburse}}">
							${{summary.earnings.current.total_reimburse | formatPrice}}
						</td>
					</tr>
					<tr ng-if="summary.earnings.previous.payment_status">
						<td>Last week's payment</td>
						<td positive-or-negative-color="{{summary.earnings.previous.payment_status.pending.payment}}">
							${{summary.earnings.previous.payment_status.pending.payment | formatPrice}}
						</td>
					</tr>
					<tr ng-if="summary.earnings.previous.payment_status">
						<td>Last week's reimbursement</td>
						<td positive-or-negative-color="{{summary.earnings.previous.payment_status.pending.reimburse}}">
							${{summary.earnings.previous.payment_status.pending.reimburse | formatPrice}}
						</td>
					</tr>
				</tbody>
			</table>
			<br>

		</div>

	</div>

	<div ng-if="summary.weeks" class="driver-summary">

		<h2 class="title">View Details</h2>

		<table class="tb-grid tb-zebra-summary">
			<thead>
				<tr>
					<td style="max-width: 15px"></td>
					<td>Period</td>
					<td>Payment</td>
					<td>Reimbursement</td>
					<tr>
			</thead>
			<tbody ng-repeat="week in summary.weeks">
				<tr>
					<td>
						<span class="link" ng-click="week.show_week = !week.show_week">
							<i class="orange fa fa-plus-square-o" ng-show="!week.show_week"></i>
							<i class="fa fa-minus-square-o" ng-show="week.show_week"></i>
						</span>
					</td>
					<td>
						<span class="hide-tiny-screen">From</span> {{week.period}}
					</td>
					<td positive-or-negative-color="{{week.total_payment}}">
						${{week.total_payment | formatPrice}}
					</td>
					<td positive-or-negative-color="{{week.total_payment}}">
						${{week.total_reimburse | formatPrice}}
					</td>
				</tr>
				<tr ng-show="week.show_week">
					<td colspan="4">
						<table class="tb-grid tb-zebra-summary">
							<thead>
								<td style="max-width: 15px"></td>
								<td>Day</td>
								<td>Payment</td>
								<td>Reimbursement</td>
							</thead>
							<tbody ng-repeat="day in week.days">
								<tr>
									<td>
										<span class="link" ng-click="day.show_day = !day.show_day">
											<i class="orange fa fa-plus-square-o" ng-show="!day.show_day"></i>
											<i class="fa fa-minus-square-o" ng-show="day.show_day"></i>
										</span>
									</td>
									<td>{{day.day}}</td>
									<td positive-or-negative-color="{{day.total_payment}}">
										${{day.total_payment | formatPrice}}
									</td>
									<td positive-or-negative-color="{{day.total_reimburse}}">
										${{day.total_reimburse | formatPrice}}
									</td>
								</tr>
								<tr ng-show="day.show_day">
									<td colspan="4">
										<table class="tb-grid tb-zebra tb-zebra-summary">
											<thead>
												<tr>
													<td>Order</td>
													<td>Customer</td>
													<td>Tip</td>
													<td>Delivery Fee</td>
													<td>Cash Markup Owed to CB</td>
													<td>Pay</td>
													<td class="hide-tiny-screen">&nbsp;</td>
													<td>Reimbursement</td>
													<td class="hide-tiny-screen">&nbsp;</td>
												</tr>
											</thead>
											<tbody ng-repeat="order in day.orders">
												<tr>
													<td>{{order.id_order}}</td>
													<td>{{order.name}}</td>
													<td positive-or-negative-color="{{order.tip}}">
														<span ng-if="order.tip == 0">
															paid in cash
														</span>
														<span ng-if="order.tip > 0">
															${{order.tip | formatPrice}}
														</span>
													</td>
													<td positive-or-negative-color="{{order.delivery_fee}}">
														${{order.delivery_fee | formatPrice}}
													</td>
													<td positive-or-negative-color="{{order.markup}}">
														${{order.markup | formatPrice}}
													</td>
													<td positive-or-negative-color="{{order.total_payment}}">
														${{order.total_payment | formatPrice}}
														<span class="show-tiny-screen" ng-class="{ 'span-driver-summary-paid': order.payment.status == 'Paid',
																							'span-driver-summary-pending': order.payment.status == 'Pending',
																							'span-driver-summary-processing': order.payment.status == 'Processing' }">
															{{order.payment.status}}
														</span>
													</td>
													<td class="hide-tiny-screen">
														<span ng-class="{ 'span-driver-summary-paid': order.payment.status == 'Paid',
																							'span-driver-summary-pending': order.payment.status == 'Pending',
																							'span-driver-summary-processing': order.payment.status == 'Processing' }">
															{{order.payment.status}}
														</span>
													</td>
													<td positive-or-negative-color="{{order.total_reimburse}}">
														${{order.total_reimburse | formatPrice}}
														<span class="show-tiny-screen" ng-class="{ 'span-driver-summary-paid': order.reimburse.status == 'Paid',
																							'span-driver-summary-pending': order.reimburse.status == 'Pending',
																							'span-driver-summary-processing': order.reimburse.status == 'Processing' }">
															{{order.reimburse.status}}
														</span>
													</td>
													<td class="hide-tiny-screen">
														<span ng-class="{ 'span-driver-summary-paid': order.reimburse.status == 'Paid',
																							'span-driver-summary-pending': order.reimburse.status == 'Pending',
																							'span-driver-summary-processing': order.reimburse.status == 'Processing' }">
															{{order.reimburse.status}}
														</span>
													</td>
												</tr>
											</tbody>
										</table>
									</td>
								</tr>
							</tbody>
						</table>
					</td>
				</tr>
			</tbody>
		</table>

		<h4 class="title">*Reimbursement is equal to amount paid to restaurant.</h4>

	</div>

	<div ng-if="!summary.weeks && !isLoading" class="box-content">
		Nothing here.
	</div>

</div>

<spinner-loading></spinner-loading>
<hack-expand-content></hack-expand-content>